<h1>My Courses</h1>
<div class="global-search-bar">
    <input type="text" placeholder="Search courses by name or keyword...">
</div>
<div class="lists-wrapper">
    <section id="enrolled-courses">
        <h2>My Learning</h2>
        <div class="sorting-options">
            <label for="sort-enrolled">Sort By:</label>
            <select id="sort-enrolled" [(ngModel)]="currentSortEnrolled" (ngModelChange)="applyEnrolledSorting()">
                <option value="name-asc">Name (A-Z)</option>
                <option value="name-desc">Name (Z-A)</option>
                <option value="date-new">Latest Activity</option>
            </select>
        </div>
        <ul class="course-list">
            @if (isLoadingSubscribed) {
            <p>Loading your courses...</p>
            } @else {
            @for (course of memberSubscribedCourses | slice:0:currentSubscribedLimit ; track course.id) {
            <li class="course-card">
                <a routerLink="/course/{{course.id}}">
                    <h3>{{ course.title }}</h3>
                    <p>Category: {{ course.category }}</p>
                    <p>Level: {{ course.difficultyLevel }}</p>
                </a>
                <button type="button" class="btn-unsubscribe" [disabled]="isUnsubscribing === course.id" (click)="unsubscribe(course.id)">

                    @if (isUnsubscribing === course.id) {
                        <span>Processing...</span>
                    }@else {
                        <span>Unsubscribe</span>
                    }
                </button>
            </li>
            }
            @if (memberSubscribedCourses.length === 0 && !isLoadingSubscribed) {
                <p>You are not enrolled in any courses yet.</p>
            }
            }

            @if (memberSubscribedCourses.length > currentSubscribedLimit) {
                <li class="action-card-wrapper load-more-button">
                    <button (click)="loadMoreSubscribedCourses()" class="action-link">
                        <span>load more courses ({{ memberSubscribedCourses.length - currentSubscribedLimit }} remaining)</span>
                    </button>
                </li>
                }
            <li class="action-card-wrapper">
                <a routerLink="/courses" class="action-link">+<span>Find Courses</span></a>
            </li>
        </ul>
    </section>
    <section id="dictated-courses">
        <h2>My Teaching</h2>
        <div class="sorting-options">
            <label for="sort-dictated">Sort By:</label>
            <select id="sort-dictated" [(ngModel)]="currentSortTeaching" (ngModelChange)="applyTeachingSorting()">
                <option value="name-asc">Name (A-Z)</option>
                <option value="name-desc">Name (Z-A)</option>
                <option value="date-created">Date Created</option>
            </select>
        </div>
        <ul class="course-list">
            @if (isLoadingTeaching) {
            <p>Loading your courses...</p>
            } @else {
            @for (course of memberTeachingCourses | slice:0:currentTeachingLimit ; track course.id) {
            <li class="course-card">
                <a routerLink="/course/{{course.id}}">
                    <h3>{{ course.title }}</h3>
                    <p>Category: {{ course.category }}</p>
                    <p>Level: {{ course.difficultyLevel }}</p>
                </a>
                <a routerLink="/edit-course/{{ course.id }}">Edit Course</a>
                <button type="button" class="btn-delete" (click)="openDeleteConfirm(course)">
                    Delete Course
                </button>
            </li>
            @if (isDeleteModalVisible) {
            <div class="modal-overlay">
                <div class="modal-content">
                    <h4>Are you sure?</h4>
                    <p>
                        You are about to permanently delete the course:
                        <strong>{{ courseToDelete?.title }}</strong>
                    </p>
                    <div class="modal-actions">
                        <button type="button" (click)="closeDeleteConfirm()" class="btn-cancel">
                            Cancel
                        </button>
                        <button type="button" (click)="confirmDelete()" class="btn-confirm-delete">
                            Delete Course
                        </button>
                    </div>
                </div>
            </div>
            }
            }
            }
            @if (memberTeachingCourses.length > currentTeachingLimit) {
            <li class="action-card-wrapper load-more-button">
                <button (click)="loadMoreTeachingCourses()" class="action-link">
                    <span>load more courses ({{ memberTeachingCourses.length - currentTeachingLimit }} remaining)</span>
                </button>
            </li>
            }

            <li class="action-card-wrapper">
                <a routerLink="/courses/new" class="action-link">+ <span>Create course</span></a>
            </li>

            @if (memberTeachingCourses.length === 0 && !isLoadingTeaching) {
            <p>You haven't created any courses yet.</p>
            }
        </ul>
    </section>
</div>